<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ | ÙØ³Ø§ØªÙŠÙ† Ø®ÙŠØ§Ù„ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  margin:0;
  background:#FFFDFB; /* same as other pages */
  color:#5A3A44;
}

/* ===== NAVBAR ===== */
.navbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:18px 40px;
  background:#E8B7C8; /* same as other pages */
  color:#5A3A44;
  box-shadow:0 2px 8px rgba(201,122,149,0.25);
}

.logo {
    display:flex;
    align-items:center;
    gap:10px;
    font-size:1.4rem;
    font-weight:700;
}

.logo img {
    width: 90px;
    height: 90px;
    object-fit: contain;
    border-radius:5px;
}

.nav-links {
  list-style:none;
  display:flex;
  gap:30px;
  align-items:center;
  margin:0;
  padding:0;
}

.nav-links a {
  color:#5A3A44;
  text-decoration:none;
  font-weight:600;
}

.nav-links a:hover { color:#C97A95; }

/* ===== CART ICON ===== */
.cart-icon {
  display:flex;
  align-items:center;
  position:relative;
}

.cart-icon img {
  width:30px;
  height:30px;
}

.cart-badge {
  position:absolute;
  top:-8px;
  right:-8px;
  background:#C97A95;
  color:#fff;
  font-size:0.75rem;
  font-weight:700;
  padding:2px 6px;
  border-radius:12px;
}

/* ===== CHECKOUT LAYOUT ===== */
.checkout-container {
  display:flex;
  flex-wrap:wrap;
  max-width:1050px;
  margin:60px auto;
  gap:35px;
}

.checkout-left,
.checkout-right {
  flex:1;
  min-width:320px;
  background:#ffffff;
  padding:35px;
  border-radius:28px;
  box-shadow:0 18px 40px rgba(201,122,149,0.18);
}

.checkout-left h2,
.checkout-right h3 { color:#C97A95; margin-bottom:20px; }

/* FORM */
input, textarea {
  width:100%;
  padding:14px;
  margin:8px 0 18px;
  border-radius:30px;
  border:1px solid #F1C3D6;
  font-size:0.95rem;
  outline:none;
}

input:focus,
textarea:focus { border-color:#C97A95; }
#customerNote { min-height:80px; resize: vertical; }

/* BUTTON */
button, .btn-primary {
  display:block;
  width:100%;
  padding:15px;
  border-radius:30px;
  border:none;
  cursor:pointer;
  font-weight:600;
  margin-top:12px;
  background:#C97A95;
  color:#fff;
  transition:0.3s;
}
button:hover, .btn-primary:hover { background:#A45B73; }

/* ORDER SUMMARY */
.order-items { margin-bottom:25px; }
.summary { border-top:1px solid #F1D6E0; padding-top:18px; }
.summary-row { display:flex; justify-content:space-between; margin:8px 0; color:#5A3A44; }
.total-row { font-weight:700; font-size:1.1rem; color:#C97A95; }
.secure-text { margin-top:15px; font-size:0.9rem; color:#5A3A44; }

/* FOOTER */
footer { text-align:center; padding:22px; color:#5A3A44; font-weight:500; }

/* TOAST */
#toast {
  visibility:hidden;
  min-width:250px;
  max-width:320px;
  margin-left:-160px;
  background:linear-gradient(135deg, #FFC1CC, #FFD6E0);
  color:#5A3A44;
  font-weight:600;
  text-align:center;
  border-radius:20px;
  padding:16px;
  position:fixed;
  z-index:9999;
  left:50%;
  bottom:30px;
  font-family:'Poppins',sans-serif;
  box-shadow:0 6px 18px rgba(201,122,149,0.3);
  transform: translateY(20px);
  opacity:0;
  transition: opacity 0.5s ease, transform 0.5s ease;
}
#toast.show {
  visibility: visible;
  opacity:1;
  transform: translateY(0);
}
.toast-sparkle {
  display:inline-block;
  animation:sparkle 1s ease forwards;
  margin-left:5px;
  font-size:1.2rem;
}
@keyframes sparkle {
  0% {transform: scale(0.8) rotate(0deg); opacity:0;}
  50% {transform: scale(1.2) rotate(20deg); opacity:1;}
  100% {transform: scale(1) rotate(-10deg); opacity:0;}
}
</style>
</head>
<body>

<!-- ===== NAVBAR ===== -->
<nav class="navbar">
  <div class="logo">
    <img src="fairytale2.jpg" alt="Fairytale Logo">
    ÙØ³Ø§ØªÙŠÙ† Ø®ÙŠØ§Ù„ÙŠØ©
  </div>
  <ul class="nav-links">
    <li><a href="index_ar.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
    <li><a href="collection_ar.html">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</a></li>
    <li>
      <a href="cart_ar.html" class="cart-icon">
        <img src="cart.jpg" alt="Ø§Ù„Ø³Ù„Ø©">
        <span class="cart-badge" id="cart-count">0</span>
      </a>
    </li>
  </ul>
</nav>

<!-- ===== CHECKOUT ===== -->
<div class="checkout-container">

  <!-- CUSTOMER INFO -->
  <div class="checkout-left">
    <h2>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h2>
    <p>Ø£ÙƒÙ…Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ø£Ù…Ø§Ù†</p>

    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
    <input type="text" id="customerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>

    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
    <input type="tel" id="customerPhone" placeholder="+968 XXXXXXXX" required>

    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„</label>
    <textarea id="customerAddress" placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø¯ÙˆÙ„Ø©" required></textarea>

    <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù„Ø¨Ø§Ø¦Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <textarea id="customerNote" placeholder="Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø£Ùˆ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ©"></textarea>

    <h3>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
    <div class="payment-box">
      <input type="radio" checked> Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† / Ø®ØµÙ… (Stripe)
    </div>

    <button class="btn-primary" onclick="sendOrderEmail()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
  </div>

  <!-- ORDER SUMMARY -->
  <div class="checkout-right">
    <h3>Ø·Ù„Ø¨Ùƒ</h3>
    <div id="cartItems" class="order-items"></div>

    <div class="summary">
      <div class="summary-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</span><span>$<span id="total">0</span></span></div>
      <div class="summary-row"><span>Ø§Ù„ØªÙˆØµÙŠÙ„</span><span>Ù…Ø¬Ø§Ù†ÙŠ</span></div>
      <div class="summary-row total-row"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span>$<span id="finalTotal">0</span></span></div>
    </div>

    <p class="secure-text">ğŸ”’ Ø¹Ù…Ù„ÙŠØ© Ø¯ÙØ¹ Ø¢Ù…Ù†Ø© â€¢ Ù…Ø­Ù…ÙŠØ© Ø¨Ø´Ù‡Ø§Ø¯Ø© SSL</p>
  </div>

</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
// ===== CART =====
const cartCountBadge = document.getElementById("cart-count");
let cart = JSON.parse(localStorage.getItem("cart")) || [];
cartCountBadge.textContent = cart.length;

function renderCart() {
  const cartItemsDiv = document.getElementById("cartItems");
  const totalSpan = document.getElementById("total");
  const finalTotalSpan = document.getElementById("finalTotal");

  cartItemsDiv.innerHTML = "";
  let total = 0;
  cart.forEach(item => {
    total += Number(item.price);
    const div = document.createElement("div");
    div.innerHTML = `â€¢ ${item.name} (${item.size}) - $${item.price}`;
    cartItemsDiv.appendChild(div);
  });
  totalSpan.innerText = total;
  finalTotalSpan.innerText = total;
}
renderCart();

// ===== TOAST =====
function showToast(message) {
  const toast = document.getElementById("toast");
  toast.innerHTML = message + ' <span class="toast-sparkle">âœ¨</span>';
  toast.className = "show";
  setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

// ===== SEND ORDER =====
function sendOrderEmail() {
  const name = document.getElementById("customerName").value;
  const phone = document.getElementById("customerPhone").value;
  const address = document.getElementById("customerAddress").value;
  const note = document.getElementById("customerNote").value;

  if(!name || !phone || !address){
    showToast("âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
    return;
  }
  if(cart.length === 0){
    showToast("âŒ Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!");
    return;
  }

  // Save order locally
  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  orders.push({ customer: JSON.parse(localStorage.getItem("currentUser")), items: cart, note, total: document.getElementById("total").innerText });
  localStorage.setItem("orders", JSON.stringify(orders));

  localStorage.removeItem("cart");
  showToast("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
  setTimeout(() => { window.location.href = "index_ar.html"; }, 1500);
}

// ===== CHECK LOGIN =====
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){
    alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "register.html";
}
</script>

</body>
</html>
